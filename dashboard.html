
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>jsonoff | Simple Dashboard for MQTT relay with button</title>
<meta property="og:title" content="jsonoff" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Simple Dashboard for MQTT relay with button" />
<meta property="og:description" content="Simple Dashboard for MQTT relay with button" />
<link rel="canonical" href="https://settenke.github.io/jsonoff/" />
<meta property="og:url" content="https://settenke.github.io/jsonoff/" />
<meta property="og:site_name" content="jsonoff" />
<script type="application/ld+json">
{"name":"jsonoff","description":"Simple Dashboard for MQTT relay with button","author":null,"@type":"WebSite","url":"https://settenke.github.io/jsonoff/","image":null,"publisher":null,"headline":"jsonoff","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.1/js/all.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.2.0/css/iziToast.min.css" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.2.0/js/iziToast.min.js" type="text/javascript"></script>

    <meta name="description" content="Simple Dashboard for MQTT relay with button"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/jsonoff/assets/css/style.css?v=749d6dcf858af1a696a6075434aa92131a18fdaf">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">jsonoff</h1>
      <h2 class="project-tagline">Simple Dashboard for MQTT relay with button</h2>
      
        <a href="https://github.com/settenke/jsonoff" class="btn">View on GitHub</a>
        <a href="javascript:toggleLamp()" class="btn"><i class="fas fa-lightbulb"></i> Toggle lamp</a>
      
      
    </section>

    <section class="main-content">
      <h1 id="jsonoff">jsonoff</h1>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/settenke/jsonoff">jsonoff</a> is maintained by <a href="https://github.com/settenke">settenke</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </section>

    <script type="text/javascript">
      var state = 'OFF';
      var client;
      
      function getUrlParameter(name) {
          name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
          var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
          var results = regex.exec(location.search);
          return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
      }
      
      function showNotification(message) {
        iziToast.show({
          id: 'jsonotif'
          title: 'Huston!',
          message: 'We have a problem: ' + message,
          position: 'topCenter',
          timeout: false,
          theme: 'dark',
          transitionIn: 'flipInX',
          transitionOut: 'flipOutX',
          progressBarColor: 'rgb(0, 255, 184)',
          image: '/lightbulb.jpg',
          imageWidth: 70,
          layout: 2,
          iconColor: 'rgb(0, 255, 184)'
        });
      }
      
      function connect() {
        client = new Paho.MQTT.Client("m23.cloudmqtt.com", 30392, "web_" + parseInt(Math.random() * 100, 10));

        client.onConnectionLost = onConnectionLost;
        client.onMessageArrived = onMessageArrived;
        var options = {
          useSSL: true,
          userName: getUrlParameter('username'),
          password: getUrlParameter('password'),
          onSuccess:onConnect,
          onFailure:doFail
        }
        
        client.connect(options);
      }
      
      function onConnect() {
        console.log("onConnect");
        client.subscribe("/jsonoff/lamp");
      }

      function doFail(e){
        console.log(e);
      }

      // called when the client loses its connection
      function onConnectionLost(responseObject) {
        if (responseObject.errorCode !== 0) {
          console.log("onConnectionLost:"+responseObject.errorMessage);
        }
      }

      // called when a message arrives
      function onMessageArrived(message) {
        console.log("onMessageArrived:"+message.payloadString);
        document.getElementsByClassName('fa-lightbulb')[0].setAttribute('data-prefix', (message.payloadString === 'ON' ? 'far' : 'fas'));
      }
      
      
      function toggleLamp() {
        state = state === 'ON' ? 'OFF' : 'ON';
       
        message = new Paho.MQTT.Message(state);
        message.destinationName = "/jsonoff/lamp";
        message.retained = true;
        client.send(message);
      }
      
      document.addEventListener("DOMContentLoaded", function(event) {
        if (getUrlParameter('username') == '' || getUrlParameter('password') == '') {
          showNotification('Username and Password is required!');
        } else {
          connect();
        }
      });
      
    </script>
  </body>
</html>
